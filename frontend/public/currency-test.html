<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdiFy Currency Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-result { margin: 10px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        .success { background: #004d00; border-color: #00ff00; }
        .error { background: #4d0000; border-color: #ff0000; }
        .loading { background: #4d4d00; border-color: #ffff00; }
        button { padding: 10px 20px; margin: 10px 5px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0088ff; }
        .currency-display { font-size: 24px; font-weight: bold; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>AdiFy Currency System Test</h1>
    <p>Testing the geolocation-based ZAR currency system</p>
    
    <button onclick="testCurrencyAPI()">Test Currency API</button>
    <button onclick="testUserBalance()">Test User Balance</button>
    <button onclick="testVideoRewards()">Test Video Rewards</button>
    <button onclick="testLocation()">Test Location</button>
    
    <div id="results"></div>

    <script>
        function addResult(title, content, status = 'success') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(content, null, 2)}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }

        async function testCurrencyAPI() {
            addResult('Currency API Test', 'Loading...', 'loading');
            try {
                const response = await fetch('/api/user/currency-info?lat=-26.2041&lng=28.0473');
                const data = await response.json();
                addResult('Currency API Test', data, 'success');
                
                // Test currency formatting
                const testAmount = 2.50; // USD
                const zarAmount = testAmount * data.exchangeRate;
                const formatted = `${data.formatting.symbol}${zarAmount.toFixed(data.formatting.decimals)}`;
                addResult('Currency Formatting Test', {
                    originalUSD: `$${testAmount}`,
                    convertedZAR: formatted,
                    exchangeRate: data.exchangeRate
                }, 'success');
                
            } catch (error) {
                addResult('Currency API Test', { error: error.message }, 'error');
            }
        }

        async function testUserBalance() {
            try {
                const response = await fetch('/api/user/balance');
                const data = await response.json();
                addResult('User Balance Test', data, 'success');
            } catch (error) {
                addResult('User Balance Test', { error: error.message }, 'error');
            }
        }

        async function testVideoRewards() {
            try {
                const response = await fetch('/api/videos/available');
                const data = await response.json();
                addResult('Video Rewards Test', data, 'success');
            } catch (error) {
                addResult('Video Rewards Test', { error: error.message }, 'error');
            }
        }

        function testLocation() {
            if (!navigator.geolocation) {
                addResult('Location Test', { error: 'Geolocation not supported' }, 'error');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    addResult('Location Test', {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    }, 'success');
                },
                (error) => {
                    addResult('Location Test', { error: error.message }, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        // Auto-run all tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testCurrencyAPI();
                setTimeout(() => testUserBalance(), 500);
                setTimeout(() => testVideoRewards(), 1000);
                setTimeout(() => testLocation(), 1500);
            }, 1000);
        });
    </script>
</body>
</html>